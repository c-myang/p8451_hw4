---
title: "Assignment 4"
output: html_document
date: "2023-02-14"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      warning = F,
                      message = F)
```


```{r load_packages}
library(tidyverse)
library(caret)
library(ggbiplot)
library(stats)
library(factoextra)
library(cluster)
```

## Part I: Implementing a Simple Prediction Pipeline

The New York City Department of Health administered a questionnaire on general health and physical activity among residents. 

### Step 1: Load data and prepare for analysis

```{r load_data}
PAT_df = readr::read_csv("./class4_p1.csv") %>% 
  dplyr::rename(id = `...1`,
                htn = chronic1,
                diabetes = chronic3,
                asthma = chronic4,
                tobacco = tobacco1,
                alcohol = alcohol1,
                pa_min = gpaq8totmin,
                walk_days = gpaq11days,
                physical_act = habits5,
                diet = habits7,
                gender = dem3,
                hisp_lat = dem4,
                us_born = dem8) %>% 
  mutate_at(vars(htn:asthma, tobacco:alcohol, physical_act:povertygroup), ~ as.factor(.)) 

summary(PAT_df) %>% knitr::kable()
```

### Step 2: Partitioning the data

```{r partition_data}
set.seed(123)

#Drop category and ID variable and remove missings
PAT_df = PAT_df %>% 
  select(-id) %>% 
  na.omit()

#Centering and Scaling
PAT_numeric <- PAT_df %>% dplyr::select(where(is.numeric))
set_up_preprocess = preProcess(PAT_numeric, method = c("center", "scale"))

#Output pre-processed values
transformed_vals = predict(set_up_preprocess, PAT_numeric)

#Creating balanced partitions in the data
train_index = createDataPartition(PAT_df$healthydays, p = 0.7, list = FALSE)

PAT_train = PAT_df[train_index,]
PAT_test = PAT_df[-train_index,]

summary(PAT_test$healthydays)
summary(PAT_train$healthydays)
```

### Step 3: Construct linear regression models to predict healthy days

We will fit two linear models to predict the number of days in a month an individual reported having good physical health (feature name: healthydays).
* Model 1: Include all features
* Model 2: Include only habits

```{r lm}
#Perform 10-fold cross-validation
control.settings = trainControl(method = "cv", number = 10)

lasso = train(healthydays ~., data = PAT_train, method = "glmnet", preProc=c("center", "scale"), trControl = control.settings)

lasso$results




```


## Part II: Conducting an Unsupervised Analysis

